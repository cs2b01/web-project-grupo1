{% extends "layout.html" %}


{% block navbarposition %}
<nav class="navbar navbar-expand-md navbar-dark Bggrey" id="navbarMain">
{% endblock %}


{% block content %}

<div class="container">

	<!-- ------------------------------ SHOP ITEMS TABLE ------------------------------ -->

	<h4 class="text-center mt-3 mb-5">Dostępny asortyment</h4>

	<div class="table-responsive">
		<table class="table">
			<thead>
				<tr>
					<th scope="col">ID</th>
					<th scope="col"></th>
					<th scope="col">Nazwa</th>
					<th scope="col">Opis główny</th>
					<th scope="col">Opis dodatkowy</th>
					<th scope="col">Cena</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				{% for i in itemsList %}
				<tr>
					<td class="align-middle">{{ i.id }}</td>
					<td class="align-middle"><img class="img-fluid Img125 img-responsive" 
			src="{{url_for('static', filename='images/shop/'+ i.itemImage)}}" 
			alt="Item image"></td>
					<td class="align-middle text-nowrap">{{ i.itemName }}</td>
					<td class="align-middle">{{ i.itemMainDescription }}</td>
					<td class="align-middle text-nowrap">{{ i.itemPointsDescription | safe }}</td>
					<td class="align-middle">{{ i.itemPrice }}</td>
					<td class="align-middle">
						<form action = "/shopmanagement" method = "POST">
							<button class="btn btn-outline-light" name="deletedItemID" value="{{ i.id }}">Usuń</button>
						</form>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>


	<!-- ------------------------------ NEW ITEM FORM ------------------------------ -->

	<h4 class="text-center mt-5 mb-5">Dodawanie asortymentu</h4>

	<div class="row justify-content-center">
		<div class="col-lg-6 col-md-9 col-sm-12">
			<!-- enctype - needs to be defined to make files upload possible -->
			<form action = "/shopmanagement" method = "POST" enctype="multipart/form-data">
				{{ form.hidden_tag() }} <!-- protection against attacks -->
				
				<div class="form-group">
					{{ form.itemName.label(class="form-control-label") }}
					{% if form.itemName.errors %}
						{{ form.itemName(class="form-control is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.itemName.errors %}
							<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						{{ form.itemName(class="form-control") }}
					{% endif %}
				</div>

				<div class="form-group">
					{{ form.itemMainDescription.label(class="form-control-label") }}
					{% if form.itemMainDescription.errors %}
						{{ form.itemMainDescription(class="form-control is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.itemMainDescription.errors %}
							<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						{{ form.itemMainDescription(class="form-control", rows='3') }}
					{% endif %}
				</div>

				<!-- CKEditor (text editor) implementation - id="editor" -->
				{{ form.itemPointsDescription.label(class="form-control-label") }} <!--taken outside the div with "Blacktext" class-->
				<div class="form-group Blacktext">
					{% if form.itemPointsDescription.errors %}
						{{ form.itemPointsDescription(class="form-control is-invalid", id="editor") }}
						<div class="invalid-feedback">
							{% for error in form.itemPointsDescription.errors %}
							<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						{{ form.itemPointsDescription(class="form-control", id="editor") }}
					{% endif %}
				</div>

				<div class="form-group">
					{{ form.itemImage.label() }}
					<div> <!-- div for good layout on smaller screens -->
					{{ form.itemImage() }}
					</div>
					<!-- different way of throwing errors to file field -->
					{% if form.itemImage.errors %}
					{% for error in form.itemImage.errors %}
						<p class="text-danger text-xs">{{ error }}</p>
					{% endfor %}
					{% endif %}
				</div>

				<div class="form-group">
					<!-- enctype - needs to be defined to make files upload possible -->
					{{ form.itemPrice.label(class="form-control-label") }}
					{% if form.itemPrice.errors %}
						{{ form.itemPrice(class="form-control is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.itemPrice.errors %}
							<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						{{ form.itemPrice(class="form-control") }}
					{% endif %}
				</div>
				
				<div class="form-group">
					{{ form.submit(class="btn btn-outline-light mt-4") }}
				</div>

			</form>
		</div>
	</div>


	<!-- ------------------------------ CKEDITOR IMPORT ------------------------------ -->

	<div>
		<!-- Import -->
		<script src="https://cdn.ckeditor.com/ckeditor5/11.2.0/classic/ckeditor.js"></script>

		<!-- Configuration -->
		<script>
			ClassicEditor
		.create( document.querySelector( '#editor' ), {
			removePlugins: [ 'Heading', 'BlockQuote' ],
			toolbar: ['bold', 'italic', 'link', 'bulletedList', 'numberedList'],
		} )
		.catch( error => {
			console.log( error );
		} );
		</script>
	</div>

</div>

{% endblock content %}
